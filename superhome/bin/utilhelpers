#!/bin/zsh

#=========================#
# General utility Helpers #
#=========================#

function myip() {
    ifconfig | grep "inet[^6]"
}

function dostat() {
    stat -f "name: \"%SN\" path: \"%SR\" type: \"%ST\" permissions: \"%Sp = %Up\" inode \"%Ui\" dev: \"%Sd = %Ud\" hard links: \"%Ul\" size: \"%Uz\" sym link target: \"%SY\"" "$1"
}

function fzfpreview() {
    fzf --preview 'bat --style=numbers --color=always --line-range :500 {}'
}

function fzfp() {
    if [ -z $1 ]; then
        local TARGET="."
    else
        local TARGET="$1"
    fi
    #ls -al $TARGET
    find $TARGET -maxdepth 1 | sed 's/^\.\///g' | fzf --preview 'opener {}'
}

function fzfpp(){
    find . | sed 's/^\.\///g' | fzf --preview 'opener {}'
}

function fzfppls(){
    fzfpp | xargs -n 1 -I {} $(echo $aliases[ll]) {}
}

function npmglobals() {
  npm list -g --depth 0
}

function usage() {
    echo "Usage: utilhelpers <cmd> [<args>]"
    echo "Available commands:"
    echo "\thelp: usage (this message)"
    echo "\tmyip: get my ip address"
    echo "\tdostat <dir>: stat the given directory"
    echo "\tfzfpreview: preview with fzf and bat"
    echo "\tfzfp: preview with fzf exa hexyl and bat"
    echo "\tfzfpp: fzf preview all levels"
    echo "\tfzfppls: fzf preview -> select item -> ls it"
    echo "\tnpmglobals: list globally installed npm packages"
}

case "$1" in
    myip)
        myip
        ;;
    dostat)
        dostat "$2"
        ;;
    fzfpreivew)
        fzfpreview
        ;;
    fzfp)
        fzfp
        ;;
    fzfpp)
        fzfpp
        ;;
    fzfppls)
        fzfppls
        ;;
    npmglobals)
        npmglobals
        ;;
    help)
        usage
        ;;
    *)
        echo "Invalid command: $@"
        usage
        exit 1
        ;;
esac

