-- ⌘ ⌃ ⌥ ⇧ ↹ ↩ ⌫

local markdowncontent = [[

# Hotkeys

## Hammerspoon

**hyper**
`⌘ ⌃ ⌥ _`
**super**
`⌃ ⌥ _`
**suuper**
`⇧ ⌃ ⌥ _`
**layoutSuper**
`⌘ ⌃ _`
**layoutSuuper**
`⇧ ⌘ ⌃ _`

| Description | Command |
| :---    |        ---: |
| --- | --- |
| toggle shortcuts (this window) | `⌘ ⌃ /` |
| window layout - max | `⌘ ⌃ m` |
| window layout - center `3/4` | `⌘ ⌃ ,` |
| window layout - center `1/2` | `⌘ ⌃ c` |
| window layout - left `1/2` | `⌘ ⌃ h` |
| window layout - right `1/2` | `⌘ ⌃ l` |
| window layout - center `2/3` | `⌘ ⌃ i` |
| window layout - left `2/3` | `⌘ ⌃ <-` |
| window layout - right `2/3` | `⌘ ⌃ ->` |
| window layout - top left `1/2` | `⌘ ⌃ u` |
| window layout - top right `1/2` | `⌘ ⌃ o` |
| window layout - bottom left `1/2` | `⌘ ⌃ n` |
| window layout - bottom right `1/2` | `⌘ ⌃ .` |
| window layout - top left `1/3` | `⌘ ⌃ ⇧ u` |
| window layout - top right `1/3` | `⌘ ⌃ ⇧ o` |
| window layout - bottom left `1/3` | `⌘ ⌃ ⇧ n` |
| window layout - bottom right `1/2` | `⌘ ⌃ ⇧ .` |
| window layout - center top `1/2` | `⌘ ⌃ w` |
| window layout - center left `1/2` | `⌘ ⌃ a` |
| window layout - center right `1/2` | `⌘ ⌃ d` |
| window layout - center bottom `1/2` | `⌘ ⌃ s` |
| window layout - left `1/3` | `⌘ ⌃ ⇧ <-` |
| window layout - right `1/3` | `⌘ ⌃ ⇧ ->` |
| window layout - center top `1/3` | `⌘ ⌃ ⇧ w` |
| window layout - center left `1/3` | `⌘ ⌃ ⇧ a` |
| window layout - center right `1/3` | `⌘ ⌃ ⇧ d` |
| window layout - center bottom `1/2` | `⌘ ⌃ ⇧ s` |
| window layout - move to next screen | `⌘ ⌃ j` |
| window layout - move to prev screen | `⌘ ⌃ k` |
| window layout - move to left space | `⌘ ⌃ ⇧ h` |
| window layout - move to right space | `⌘ ⌃ ⇧ l` |
| mouse move - big move mouse left | `⌃ ⌥ h` |
| mouse move - big move mouse right | `⌃ ⌥ l` |
| mouse move - big move mouse down | `⌃ ⌥ j` |
| mouse move - big move mouse up | `⌃ ⌥ k` |
| mouse move - small move mouse left | `⇧ ⌃ ⌥ h` |
| mouse move - small move mouse right | `⇧ ⌃ ⌥ l` |
| mouse move - small move mouse down | `⇧ ⌃ ⌥ j` |
| mouse move - small move mouse up | `⇧ ⌃ ⌥ k` |
| toggle menu bar on/off | `⌘ ⌃ ⌥ m` |
| toggle dock on/off | `⌘ ⌃ ⌥ d` |
| kill notifications | `⌘ ⌃ ⌥ n` |
| window switcher next window |  `⌥ ↹` |
| open debug console | `⌘ ⌃ ⌥ c` |

## VS Code

### window layout and navigation

| Description | Command |
| :---    |        ---: |
| --- | --- |
| expand group toggle | `⌃ ,` |
| move editor group l/d/u/r | `⇧ ⌥ h/j/k/l` |
| editor into group l/d/u/r | `⇧ ⌃ h/j/k/l` |
| split editor l/d/u/r | `⌃ ⌥ h/j/k/l` |
| navigate to view on l/d/u/r | `⌃ h/j/k/l` |
| 2x2 layout | `⇧ ⌃ =` |
| 2 col layout | `⇧ ⌘ '` |
| zen mode | `⌘ k, z` |

### debugger

| Description | Command |
| :---    |        ---: |
| --- | --- |
| start | `⌘ d, b` |
| start and wait on entry | `⌘ d, w` |
| restart | `⌘ d, r` |
| disconnect | `⌘ d, x` |
| stop | `⌘ d, z` |
| continue | `⌘ d, p` |
| step in | `⌘ ⌃ ]` |
| step over | `⌘ ⌃ \` |
| step out | `⌘ ⌃ [` |

#### debugger - misc

| Description | Command |
| :---    |        ---: |
| --- | --- |
| toggle breakpoint | `⌘ k, ⌘ b` |
| toggle logpoint | `⌘ k, ⌘ l` |
| edit breakpoint | `⌘ k, ⌘ m` |
| show hover (in debug mode) | `⌘ k, ⌘ i` |

### other

| Description | Command |
| :---    |        ---: |
| --- | --- |
| show type def preview | `⌘ k, ⌘ z` |
| multicursor | `⇧ ⌥ i` |
| reveal file in explorer | `⌘ k, g` |
| toggle terminal | `⌘ ⌃ t` |
| toggle maximize terminal | `⌘ ⌃ ⌥ t` |
| rename symbol under cursor | `⌘k, ⌘r` |

## Vimac

| Description | Command |
| :---    |        ---: |
| --- | --- |
| element select (hint mode) | `⌃ f` |
| scroll mode | `⌃ s` |
| right click label | `⇧ _` |
| double click label | `⌘ _` |
| move mouse label | `⌥ _` |
| move through right click menu | `⌃ n/p` |

## Scoot

https://github.com/mjrusso/scoot?tab=readme-ov-file#usage

| Description | Command |
| :---    |        ---: |
| --- | --- |
| element selection | `⌘ ⇧ j` |
| grid | `⌘ ⇧ j` |
| freestyle start (pointer mode) | `⌘ ⇧ l` |
| grid mode - cancel label | `⌘ .` |
| move direction | `h/j/k/l` |
| move cursor full page | `⌃ h/j/k/l` |
| move cursor full step | `⌘ h/j/k/l` |
| move cursor next cell center | `⌃ l` |
| center | `⇧ m` |
| click | `↩` |
| click and hold start | `=` |
| hold release | `↩` |
| double click | `\` |
| middle mouse click | `[` |
| right mouse click | `]` |
| size grid cell | `⌘ ⇧ +/-` |
| toggle grid line visible | `⌃ ⇧ =` |
| toggle grid lable visible | `⌃ =` |

## Browser

| Description | Command |
| :---    |        ---: |
| --- | --- |
| vimiumc shortcuts | ? |
| focus address bar | `⌘ l` |
| defocus address bar | `⌘ ⌃ ⌥opt l` |
| beginning of line | `⌃ a` |
| end of line | `⌃ e` |
| back char | `⌃ b` |
| del char to right | `⌃ d` |
| back one word | `⌃ ⌥ b` |
| forward one word | `⌃ ⌥ f` |

## Misc

| Description | Command |
| :---    |        ---: |
| --- | --- |
| remove cookies, local storage, etc in Chrome | `⌘ ⇧ ⌫` |
| show all tabs in finder | `⌘ ⇧ \` |

## Native Mac
| Description | Command |
| :---    |        ---: |
| --- | --- |
| beginning of line | `⌃ a` |
| end of line | `⌃ e` |
| transpose characters | `⌃ t` |
| recenter viewport on current line | `⌃ l` |
| left one char | `⌃ b` |
| right one char | `⌃ f` |
| left one word | `⌃ ⇧ b` |
| right one word | `⌃ ⇧ f` |
| up one line | `⌃ p` |
| down one line | `⌃ n` |
| doc beginning | `⌘ ↑` |
| doc end | `⌘ ↓` |
| delete char right | `⌃ d` |
| delete char left | `⌃ h` |
| delete word right | `fn ⌥ ⌫` |
| delete word left | `⌥ ⌫` |
| delete line left | `⌘ ⌫` |
| delete line right | `⌃ k` |
| find | `⌘ f` |
| find next | `⌘ g` |
| find prev | `⌘ ⇧ g` |
| page up | `fn ↑` |
| page down | `fn ↓` or `⌃ v` |
| insert newline | `⌃ o` |
| kill | `⌃ k` |
| yank | `⌃ y` |

<style>

/* https://github.com/markdowncss/retro */

pre,
code {
  font-family: Menlo, Monaco, "Courier New", monospace;
}

pre {
  padding: .5rem;
  line-height: 1.25;
  overflow-x: scroll;
}

@media print {
  *,
  *:before,
  *:after {
    background: transparent !important;
    color: #000 !important;
    box-shadow: none !important;
    text-shadow: none !important;
  }

  a,
  a:visited {
    text-decoration: underline;
  }

  a[href]:after {
    content: " (" attr(href) ")";
  }

  abbr[title]:after {
    content: " (" attr(title) ")";
  }

  a[href^="#"]:after,
  a[href^="javascript:"]:after {
    content: "";
  }

  pre,
  blockquote {
    border: 1px solid #999;
    page-break-inside: avoid;
  }

  thead {
    display: table-header-group;
  }

  tr,
  img {
    page-break-inside: avoid;
  }

  img {
    max-width: 100% !important;
  }

  p,
  h2,
  h3 {
    orphans: 3;
    widows: 3;
  }

  h2,
  h3 {
    page-break-after: avoid;
  }
}

a,
a:visited {
  color: #01ff70;
}

a:hover,
a:focus,
a:active {
  color: #2ecc40;
}

.retro-no-decoration {
  text-decoration: none;
}

html {
  font-size: 12px;
}

@media screen and (min-width: 32rem) and (max-width: 48rem) {
  html {
    font-size: 15px;
  }
}

@media screen and (min-width: 48rem) {
  html {
    font-size: 16px;
  }
}

body {
  line-height: 1.85;
}

p,
.retro-p {
  font-size: 1rem;
  margin-bottom: 1.3rem;
}

h1,
.retro-h1,
h2,
.retro-h2,
h3,
.retro-h3,
h4,
.retro-h4 {
  margin: 1.414rem 0 .5rem;
  font-weight: inherit;
  line-height: 1.42;
}

h1,
.retro-h1 {
  margin-top: 0;
  font-size: 3.998rem;
}

h2,
.retro-h2 {
  font-size: 2.827rem;
}

h3,
.retro-h3 {
  font-size: 1.999rem;
}

h4,
.retro-h4 {
  font-size: 1.414rem;
}

h5,
.retro-h5 {
  font-size: 1.121rem;
}

h6,
.retro-h6 {
  font-size: .88rem;
}

small,
.retro-small {
  font-size: .707em;
}

/* https://github.com/mrmrs/fluidity */

img,
canvas,
iframe,
video,
svg,
select,
textarea {
  max-width: 100%;
}

html,
body {
  background-color: #222;
  min-height: 100%;
}

html {
  font-size: 18px;
}

body {
  color: #fafafa;
  font-family: "Courier New";
  line-height: 1.45;
  margin: 6rem auto 1rem;
  max-width: 48rem;
  padding: .25rem;
}

pre {
  background-color: #333;
}

blockquote {
  border-left: 3px solid #01ff70;
  padding-left: 1rem;
}
</style>
]]
local htmlcontent = hs.doc.markdown.convert(markdowncontent, "gfm")

local scrollScript = [[
//// Create the keydown event for the "j" key
//const eventJ = new KeyboardEvent('keydown', {
//  key: 'j',
//  code: 'KeyJ',
//  keyCode: 74, // KeyCode for "j"
//  which: 74,   // Which for "j"
//  bubbles: true // Allows the event to bubble up
//});
//
//// Create the keydown event for the "k" key
//const eventK = new KeyboardEvent('keydown', {
//  key: 'k',
//  code: 'KeyK',
//  keyCode: 75, // KeyCode for "k"
//  which: 75,   // Which for "k"
//  bubbles: true // Allows the event to bubble up
//});


// Event listener for keydown
document.addEventListener('keydown', (event) => {
  event.preventDefault();
  if (event.key === 'j') {
    window.scrollBy(0, window.innerHeight/2);
  } else if (event.key === 'k') {
    window.scrollBy(0, -(window.innerHeight/2));
  }
});

// Event listener for keyup
document.addEventListener('keyup', (event) => {
  event.preventDefault();
  if (event.key === 'j' || event.key === 'k') {
    scrolling = false; // Stop scrolling when either key is released
  }
});
]]

local function JScb(result, err)
  --print("result")
  --print(dump(result))
  --print("error")
  --print(dump(err))
end

wv = nil
--local jHK = nil
--local kHK = nil

--local function issueJ()
--  local js = [[
--  // Dispatch the event on the document
--  document.dispatchEvent(eventJ);
--  ]]
--  wv:evaluateJavaScript(js, JScb)
--end

--local function issueK()
--  local js = [[
--  // Dispatch the event on the document
--  document.dispatchEvent(eventK);
--  ]]
--  wv:evaluateJavaScript(js, JScb)
--end

function toggleShortcuts()
  --if jHK then
  --  if jHK.enabled then
  --    jHK:disable()
  --    --jHK:delete()
  --    --jHK = nil
  --  else
  --    jHK:enable()
  --  end
  --end

  --if kHK then
  --  if kHK.enabled then
  --    kHK:disable()
  --    --kHK:delete()
  --    --kHK = nil
  --  else
  --    kHK:enable()
  --  end
  --end

  if wv then
    if wv:isVisible() then
      wv:hide()
    elseif wv:url() ~= "about:blank" then
      wv:delete(true)
      wv = nil
      toggleShortcuts()
    else
      wv:show()
    end
    return
  end

  --local frame = hs.screen.mainScreen():frame()
  local frame = hs.screen.primaryScreen():frame()
  local rectWidthScale = 0.50
  local rectHeightScale = 0.05
  local rect = hs.geometry.rect({
    x=frame.x+frame.w*rectWidthScale/2,
    y=frame.y+frame.h*rectHeightScale/2,
    w=frame.w*(1-rectWidthScale),
    h=frame.h*(1-rectHeightScale),
  })

  wv = hs.webview.new(rect, {
    javaScriptEnabled=true,
    javaScriptCanOpenWindowsAutomatically=false,
    developerExtrasEnabled=true,
    suppressesIncrementalRendering=false
  })

  masks = hs.webview.windowMasks
  -- descriptions here:
  -- https://github.com/Hammerspoon/hammerspoon/blob/master/extensions/webview/libwebview.m#L2528
  wv:windowStyle(
    masks.borderless |
    --masks.titled |
    --masks.closable |
    --masks.resizable |
    --masks.minaturizable |
    --masks.fullSizeContentView |
    --masks.texturedBackground |
    --masks.utility |
    --masks.HUD |
    masks.nonactivating 
  )
  -- hs.drawing.windowBehaviors
  -- https://developer.apple.com/documentation/appkit/nswindow/collectionbehavior
  wv:behaviorAsLabels({
    --'default', -- 0
    'canJoinAllSpaces', -- 1
    --'moveToActiveSpace', -- 2
    'managed', -- 4
    --'transient', -- 8
    --'stationary', -- 16
    'participatesInCycle', -- 32
    --'ignoresCycle', -- 64
    --'fullScreenPrimary', -- 128
    --'fullScreenAuxiliary', -- 256
    --'fullScreenAllowsTiling', -- 2048
    --'fullScreenDisallowsTiling', -- 4096
  })
  -- https://github.com/Hammerspoon/hammerspoon/blob/master/extensions/drawing/drawing.lua#L707
  wv:level(hs.drawing.windowLevels.overlay)
  wv:windowTitle('shortcut_keys_wv')
  wv:titleVisibility('hidden')
  wv:allowMagnificationGestures(true)
  wv:allowNewWindows(false)
  wv:allowTextEntry(true)
  wv:allowNavigationGestures(true)
  wv:alpha(0.80)
  wv:bringToFront(true)
  --wv:closeOnEscape(true)
  wv:deleteOnClose(false)
  wv:shadow(true)

  wv:html(htmlcontent)
  --wv:html("<html><body contenteditable=\"true\">hello...</body></html>")

  local function donecb(action, webView, navID, error)
    --print(wv:estimatedProgress())
    if action == "didFinishNavigation" then
      wv:evaluateJavaScript(scrollScript, JScb)
    end
  end
  wv:navigationCallback(donecb)

  --jHK = hs.hotkey.bind({"alt"}, "j", issueJ)
  --kHK = hs.hotkey.bind({"alt"}, "k", issueK)

  wv:show()
end

